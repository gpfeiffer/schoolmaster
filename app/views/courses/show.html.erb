<% content_for :side do %>
  <h3>Modules</h3>
    <ul><%= render Course.all %></ul>
<% end %>

<h3><%= @course.discipline %></h3>
<h2>
  <%= @course.code %>:  
  <%= @course.title %>
  (<%= @course.credits %> ECTS)
</h2>

<p>
  <%= raw BlueCloth.new(@course.description).to_html %>
</p>

<p>
  <b>Taught</b> in Semester(s)
  <%= @course.taught %>.
  <b>Examined</b> in Semester(s)
  <%= @course.examined %>.
</p>

<p>
  <b>Workload:</b>
  <%= @course.workload %> hours
  (<%= @course.workload_text %>).
</p>

<% if can? :destroy, @course %>
<h3>Instances</h3>
<ul>
<% @course.instances.group_by(&:cohort).each do |cohort, instances| %>
<li>
<%= link_to cohort, instances_path(:cohort => cohort) %>:
<% instances.group_by(&:code).each do |code, instances_by_code| %>
<%= code %>
(<%= raw instances_by_code.map { |instance| "#{link_to instance.atom.code, instance.atom}" }.join(", ") %>);
<% end %>
</li>
<% end %>
</ul>

<h3 class="edit-head">Lecturers</h3>
<% if can? :update, @course %>
  <div class="edit">
    <%= link_to add_symbol, new_teaching_path(:course_id => @course) %>
  </div>
<% end %>
<ul>
<% @course.teachings.each do |teaching| %>
<li>
<%= link_to teaching.academic, teaching.academic %>: 
<%= teaching.load %>.
<% if can? :update, @course %>
  <div class="edit">
    <%= link_to edit_symbol, edit_teaching_path(teaching) %>
  </div>
<% end %>
</li>
<% end %>
</ul>
<% end %>

<hr />

<p>
  <b>Module Learning Outcomes.</b>
  On successful completion of this module the learner should be able to:<br />
  <%= raw BlueCloth.new(@course.outcomes).to_html %>
</p>

<hr />

<p>
  <b>Indicative Content</b>
  <%= raw BlueCloth.new(@course.content).to_html %>
</p>

<hr />

<p>
  <b>Module Resources</b>
  <%= raw BlueCloth.new(@course.resources).to_html %>
</p>

<hr />
<% if can? :edit, @course %>
<%= link_to 'Edit', edit_course_path(@course) %> |
<% end %>
<% if can? :destroy, @course %>
<%= link_to 'Destroy', @course, method: :delete, data: { confirm: 'Are you sure?' } %> |
<% end %>
<%= link_to 'Back', courses_path %>
